# SendingMeterReadings

Бот на асинхронной библиотеке aiogram для автоматической передачи показаний приборов учета. В данный момент реализована
передача показаний на сайт gas-nn.ru

Состоит из двух микросервисов:

- Bot (сам телеграм бот)
- MeterSender (отправщик показаний на сайты ресурсоснабжающих организаций)

## Подготовка

Для работы создать файл `.env`, скопировав содержимое файла `.env_example`:

<details><summary>Описание переменных</summary>

Настройки группы:

- `ADMIN` - ID админов в телеграмме
- `BOT_TOKEN` - Токен бота в телеграмме
- `PASSWORD_ENCRYPT_KEY` - Ключ для шифрования паролей в базе данных
- `gasnn_test_login` - Логин для тестирования авторизации на сайте gas-nn.ru (не обязательно)
- `gasnn_test_password` - Пароль для тестирования авторизации на сайте gas-nn.ru (не обязательно)
- `gasnn_test_account_id` - ИД аккаунта для тестирования авторизации на сайте gas-nn.ru (не обязательно)

</details>

## Запуск через докер

```
docker-compose up -d
```

## Администрирование бота

Для инициализации базы данных запустить `Bot/server.py` с ключом `--resetdb=1`. База данных будет удалена (если
существует) и создана новая.

Также доступно управление БД из бота. Для удаления и создания новой БД нужно выполнить команду `/reset`. Для заполнения
пустой базы данных тестовыми данными выполнить команду `/addtestdata`. Команды доступны только под пользователями из
списка переменной окружения 'ADMIN'. 
